<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<!--
/******************************************************************************
 * Vige, Home of Professional Open Source Copyright 2010, Vige, and           *
 * individual contributors by the @authors tag. See the copyright.txt in the  *
 * distribution for a full listing of individual contributors.                *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may    *
 * not use this file except in compliance with the License. You may obtain    *
 * a copy of the License at http://www.apache.org/licenses/LICENSE-2.0        *
 * Unless required by applicable law or agreed to in writing, software        *
 * distributed under the License is distributed on an "AS IS" BASIS,          *
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.   *
 * See the License for the specific language governing permissions and        *
 * limitations under the License.                                             *
 ******************************************************************************/
-->
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	template="/WEB-INF/templates/school.xhtml">
	<ui:define name="title">
		#{resourcebundle.Welcome} - #{resourcebundle.Report}
	</ui:define>
	<ui:define name="content">
		<h:form styleClass="reportform">
			<h:outputText value="#{resourcebundle.Subreport}"
				styleClass="subreportLabel" />
			<p:calendar id="popupmonth"
				value="#{configurationController.currentDate}"
				maxdate="#{configurationController.currentDate}"
				locale="#{configurationController.currentLocale}" navigator="true"
				mode="inline" styleClass="month">
				<p:ajax event="viewChange"
					listener="#{configurationController.onMonthSelect}"
					update="period,pupils" />
			</p:calendar>
			<h:outputText styleClass="yearlabel"
				value="#{resourcebundle.Subreportyear}" />
			<p:calendar id="popupyear"
				value="#{configurationController.currentDate}"
				maxdate="#{configurationController.currentDate}"
				locale="#{configurationController.currentLocale}" navigator="true"
				mode="inline" styleClass="year">
				<p:ajax event="viewChange"
					listener="#{configurationController.onYearSelect}"
					update="period,pupils" />
			</p:calendar>
			<h:outputText id="period"
				value="#{configurationController.formattedDate}"
				styleClass="periodLabel" />
			<p:commandButton value="#{resourcebundle.Refresh}"
				actionListener="#{pupilsController.refresh}"
				styleClass="ui-priority-primary refreshreport" update="pupils" />
			<p:commandButton value="#{resourcebundle.Insert}"
				actionListener="#{reportController.insert}"
				styleClass="ui-priority-primary pagereport" />
			<p:dataTable id="pupils" value="#{reportController.pupils}"
				filteredValue="#{reportController.filteredPupils}" var="pupil"
				widgetVar="pupilsTable"
				emptyMessage="#{resourcebundle.No_records_found}"
				sortMode="multiple">
				<p:growl id="msgs" />
				<f:facet name="header">
					<p:outputPanel>
						<h:outputText value="#{resourcebundle.Search_all}:" />
						<p:inputText id="globalFilter"
							onkeyup="PF('pupilsTable').filter()"
							placeholder="#{resourcebundle.Enter_keyword}" />
					</p:outputPanel>
				</f:facet>
				<p:column rendered="#{!configurationController.teacher}"
					headerText="#{resourcebundle.FiscalCode}" sortBy="#{pupil.id}"
					filterBy="#{pupil.id}" filterMatchMode="contains">${pupil.id}</p:column>
				<p:column headerText="#{resourcebundle.Name}" sortBy="#{pupil.name}"
					filterBy="#{pupil.name}" filterMatchMode="contains">${pupil.name}</p:column>
				<p:column headerText="#{resourcebundle.Surname}"
					sortBy="#{pupil.surname}" filterBy="#{pupil.surname}"
					filterMatchMode="contains">${pupil.surname}</p:column>
				<p:column rendered="#{configurationController.admin}"
					headerText="#{resourcebundle.Income}" sortBy="#{pupil.income}"
					filterBy="#{pupil.income}"
					filterFunction="#{filters.filterByNumber}" styleClass="income">${pupil.income}</p:column>
				<p:column rendered="#{!configurationController.teacher}"
					headerText="#{resourcebundle.Room}" sortBy="#{pupil.room}"
					filterBy="#{pupil.room}" filterMatchMode="in" styleClass="room">
					<f:facet name="filter">
						<p:selectCheckboxMenu label="#{resourcebundle.Rooms}"
							onchange="PF('pupilsTable').filter()" scrollHeight="150">
							<f:selectItems value="#{pupilsController.rooms}" />
						</p:selectCheckboxMenu>
					</f:facet>
					${pupil.room}
				</p:column>
				<p:column rendered="#{configurationController.admin}"
					headerText="#{resourcebundle.School}" sortBy="#{pupil.school}"
					filterBy="#{pupil.school}" filterMatchMode="in" styleClass="school">
					<f:facet name="filter">
						<p:selectCheckboxMenu label="#{resourcebundle.Schools}"
							onchange="PF('pupilsTable').filter()" scrollHeight="150">
							<f:selectItems value="#{pupilsController.schools}" />
						</p:selectCheckboxMenu>
					</f:facet>
					${pupil.school}
				</p:column>
				<p:column rendered="#{configurationController.admin}"
					headerText="#{resourcebundle.Quote}" sortBy="#{pupil.quote}"
					filterBy="#{pupil.quote}" filterFunction="#{filters.filterByQuote}"
					styleClass="quote">
					#{pupil.quote}
				</p:column>
				<p:column headerText="#{resourcebundle.Presences}"
					sortBy="#{pupil.presences}" filterBy="#{pupil.presences}"
					filterFunction="#{filters.filterByNumber}" styleClass="present">
					#{pupil.presences}
				</p:column>
				<p:column styleClass="detail">
					<p:commandLink actionListener="#{detail.page(pupil)}"
						title="#{resourcebundle.Detail}">
						<h:outputText styleClass="ui-icon icon-details"
							style="margin:0 auto;" />
					</p:commandLink>
				</p:column>
			</p:dataTable>
			<div id="footer">
				<ui:insert name="footer">
				#{resourcebundle.Project} <a
						href="https://flashboss.github.io/school" target="_blank">School</a>
                #{resourcebundle.Powered} <a href="http://www.vige.it"
						target="_blank">Vige Community</a>
				</ui:insert>
			</div>
		</h:form>
	</ui:define>
</ui:composition>